var haste_console=function(e){this.$options=e,this.d="\n",this.opMap={uniqc:"opUniqCount",sort:"opSort",sortn:"opSortNumeric",reverse:"opReverse",test:"opWrap"},this.uiInit()};haste_console.prototype.uiShow=function(){$("body").addClass("console")},haste_console.prototype.uiHide=function(){$("body").removeClass("console")},haste_console.prototype.uiInit=function(){var e=this;$("#console_ui").find(".new").change(function(t){if($(this).val()=="")return;var n=e.getArgs();n.push($(this).val()),e.setArgs(n),$(this).val("")})},haste_console.prototype.uiUpdate=function(){var e=this,t=$("#console_ui");t.find(".active").empty(),$(this.getArgs()).each(function(n,r){t.find(".active").append($("<li />").text(r).attr("class","op").attr("data-idx",n).attr("data-op",r).append($("<a />").html("&cross;").attr("href","#").attr("class","x").attr("data-idx",n).click(function(t){t.preventDefault();var n=$(this).attr("data-idx"),r=e.getArgs();r.splice(n,1),e.setArgs(r)})))})},haste_console.prototype.isConsoleMode=function(){var e=this.getArgs();return e!==null},haste_console.prototype.setArgs=function(e){location.hash="console:"+e.join(",")},haste_console.prototype.getArgs=function(){var e="console:",t=location.hash.substr(1),n=t.indexOf(e);if(n>=0){var r=t.substr(n+e.length);return r.length==0?[]:r.split(",")}return null},haste_console.prototype.operate=function(e){var t=this.getArgs();this.uiUpdate();for(var n in t){var r=this.opMap[t[n]];typeof this[r]=="function"&&(e=this[r](e))}return t==null||t.length==0?this.colour(e):e},haste_console.prototype.colour=function(e){var t={1:"b",2:"d",4:"u",30:"blk",31:"red",32:"grn",33:"yel",34:"blu",35:"pnk",36:"cya",37:"wht"},n="",r={},i=function(e,n,i,s){var o=Object.keys(r).length>0?"</i>":"";$(n.split(";")).each(function(e,n){n==0?r={}:typeof t[n]=="string"&&(r[t[n]]=1),n==0});if(Object.keys(r).length>0){var u=$.map(Object.keys(r),function(e){return"_"+e});o+='<i class="'+u.join(" ")+'">'}return o};return e.replace(/\x1B\[([0-9;]+)m/g,i)},haste_console.prototype.opTest=function(e){return $.map(e.split(this.d),function(e){return"["+e+"]"}).join(this.d)},haste_console.prototype.opSort=function(e){return e.split(this.d).sort().join(this.d)},haste_console.prototype.opSortNumeric=function(e){var t=function(e,t){if(e==t)return 0;var n=[/[0-9]+/.exec(e),/[0-9]+/.exec(t)];return n[0]==n[1]?0:n[1]===null?-1:n[0]===null?1:n[0]-n[1]};return e.split(this.d).sort(t).join(this.d)},haste_console.prototype.opUniqCount=function(e){var t=[],n=[];$(e.split(this.d)).each(function(e,r){t.length==0||t[t.length-1]!=r?(t.push(r),n.push(1)):n[n.length-1]++});var r=Math.max.apply(null,n),i=(""+r).length,s=function o(e,t,n){return e=e.toString(),e.length<t?o(n+e,t,n):e};return $.map(t,function(e,t){return s(n[t],i," ")+" "+e}).join(this.d)},haste_console.prototype.opReverse=function(e){return e.split(this.d).reverse().join(this.d)}